<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Allure Suite Report</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      font-size: 32px;
    }

    h2 {
      margin-top: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th,
    td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
      vertical-align: top;
    }

    .passed {
      background: #c8f7c5;
    }

    .failed {
      background: #f7c5c5;
    }

    .skipped {
      background: #dddddd;
    }

    .test-card {
      border: 1px solid #aaa;
      padding: 15px;
      margin: 15px 0;
      border-radius: 6px;
    }

    img.screenshot {
      width: 90%;
      max-width: 900px;
      height: auto;
      margin-top: 12px;
      border: 1px solid #666;
      display: block;
    }

    .error {
      color: #b00020;
      font-weight: bold;
      white-space: pre-wrap;
    }

    .trace {
      font-size: 12px;
      background: #f5f5f5;
      padding: 10px;
      border-left: 4px solid #f44336;
      white-space: pre-wrap;
      margin-top: 8px;
    }

    .page {
      page-break-before: always;
    }

    .page:first-of-type {
      page-break-before: avoid;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    window.REPORT_DATA = {"stats":{"total":15,"passed":"12 (80.00%)","failed":"1 (6.67%)","broken":"0 (0.00%)","skipped":"2 (13.33%)","retries":"61 (406.67%)"},"tests":[{"name":"After login should be in the select workspace page and click on OEM buuyer","status":"passed","suiteName":"RA buyer","uid":"a671c3cc30bf9547","start":1768817914894,"stop":1768818000111,"duration":85217,"retries":11,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"logs in successfully with valid credentials","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"60f86a3ecd5bf8dd","start":1768820483994,"stop":1768820505621,"duration":21627,"retries":23,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"logs in successfully with valid credentials and upload inspiration file","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"a8d69c5fb950a3d3","start":1768820506464,"stop":1768820545017,"duration":38553,"retries":2,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Searches for the Uploaded theme and share it with a vendor","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"cf920611139551a8","start":1768820545409,"stop":1768820635583,"duration":90174,"retries":1,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Verify that shared Inspiration is visible and submit design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"713d8e94ab33892d","start":1768820636135,"stop":1768820701056,"duration":64921,"retries":11,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Cluster Reworks the  submitted design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"e0d2e315a42de5d2","start":1768820701310,"stop":1768820744979,"duration":43669,"retries":3,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Rework","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"fe4651197504483b","start":1768820867239,"stop":1768820897448,"duration":30209,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Unparks the design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"d9df9e87578592a0","start":1768821017658,"stop":1768821046321,"duration":28663,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Parks","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"276ee7163a3080f1","start":1768821046911,"stop":1768821088970,"duration":42059,"retries":1,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Rework the parked design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"c76ea60c3164fd38","start":1768821090245,"stop":1768821129365,"duration":39120,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Vendor makes changes to rework design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"4b936764d1d90df6","start":1768821129915,"stop":1768821205091,"duration":75176,"retries":4,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Approval","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"be6718475cf26b8a","start":1768821205390,"stop":1768821271565,"duration":66175,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Cluster rejects submitted design","status":"skipped","suiteName":"Impetus Platform — Login Page Tests","uid":"ca4538512ddb0c4a","start":1768821271909,"stop":1768821271910,"duration":1,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Cluster approval for submitted design","status":"skipped","suiteName":"Impetus Platform — Login Page Tests","uid":"a68dd13f58893c4e","start":1768821271910,"stop":1768821271911,"duration":1,"retries":5,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Rejects","status":"failed","suiteName":"Impetus Platform — Login Page Tests","uid":"4c54a4c30efa5767","start":1768821271911,"stop":1768821353306,"duration":81395,"retries":0,"flaky":false,"errorMessage":"Timed out retrying after 60000ms: Expected to find content: 'SS' within the selector: 'div' but never did.","errorTrace":"AssertionError: Timed out retrying after 60000ms: Expected to find content: 'SS' within the selector: 'div' but never did.\n    at Context.eval (webpack://cypress-uvp/./cypress/support/commands.js:37:5)\n    at wrapped (https://platform.uat.impetusz0.de/__cypress/runner/cypress_runner.js:141588:43)","attachments":[]}]};
  </script>
</head>

<body>

  <h1>Allure Execution PDF</h1>

  <!-- ================= PAGE 1 ================= -->
  <div class="page">
    <h2>Summary</h2>
    <table>
      <tr>
        <th>Total</th>
        <th>Passed</th>
        <th>Failed</th>
        <th>Skipped</th>
        <th>Retries</th>
      </tr>
      <tr>
        <td id="total"></td>
        <td id="passed" class="passed"></td>
        <td id="failed" class="failed"></td>
        <td id="skipped" class="skipped"></td>
        <td id="retries"></td>
      </tr>
    </table>
    <h2>Test List</h2>
    <table id="tests-table">
      <thead>
        <tr>
          <th>Test Name</th>
          <th>Status</th>
          <th>Duration (ms)</th>
          <th>Retries</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- ================= PAGE 2 ================= -->
  <div class="page">
    <h2>Status Distribution</h2>
    <canvas id="pieChart" width="600" height="600"></canvas>
  </div>

  <!-- ================= PAGE 3 ================= -->
  <div class="page">
    <h2>Duration per Test</h2>
    <canvas id="durationChart" height="300"></canvas>
  </div>

  <!-- ================= PAGE 4+ ================= -->
  <div class="page">
    <h2>Failed Logs</h2>
    <div id="test-list"></div>
  </div>

  <script>
    /* ===== WHITE BACKGROUND FIX ===== */
    const whiteBackgroundPlugin = {
      id: 'whiteBackground',
      beforeDraw(chart) {
        const ctx = chart.ctx;
        ctx.save();
        ctx.globalCompositeOperation = 'destination-over';
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, chart.width, chart.height);
        ctx.restore();
      }
    };

    /* ===== LABELS INSIDE PIE ===== */
    const pieLabelPlugin = {
      id: 'pieLabelPlugin',
      afterDraw(chart) {
        const ctx = chart.ctx;
        const dataset = chart.data.datasets[0];
        const meta = chart.getDatasetMeta(0);

        ctx.save();
        ctx.font = "bold 16px Arial";
        ctx.fillStyle = "#ffffff";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        meta.data.forEach((arc, index) => {
          const value = dataset.data[index];
          if (!value) return;
          const pos = arc.tooltipPosition();
          ctx.fillText(`${chart.data.labels[index]}: ${value}`, pos.x, pos.y);
        });

        ctx.restore();
      }
    };

    document.addEventListener("DOMContentLoaded", () => {
      const report = window.REPORT_DATA;

      total.innerText = report.stats.total;
      passed.innerText = report.stats.passed;
      failed.innerText = report.stats.failed;
      skipped.innerText = report.stats.skipped;
      retries.innerText = report.stats.retries;

      /* ===== POPULATE TESTS TABLE ===== */
      const testsTbody = document.querySelector("#tests-table tbody");

      report.tests.forEach(test => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
    <td>${test.name}</td>
    <td class="${test.status}">${test.status}</td>
    <td>${test.duration}</td>
    <td>${test.retries}</td>
  `;
        testsTbody.appendChild(tr);
      });


      /* ===== PIE CHART ===== */
      new Chart(pieChart, {
        type: "pie",
        plugins: [whiteBackgroundPlugin, pieLabelPlugin],
        data: {
          labels: ["Passed", "Failed", "Skipped"],
          datasets: [{
            data: [
              parseInt(report.stats.passed),
              parseInt(report.stats.failed),
              parseInt(report.stats.skipped)
            ],
            backgroundColor: ["#4CAF50", "#F44336", "#9E9E9E"],
            borderWidth: 0,
            radius: "92%"
          }]
        },
        options: {
          responsive: false,
          animation: false,
          plugins: {
            legend: {
              position: "right",
              labels: {
                font: { size: 14 }
              }
            }
          }
        }
      });

      /* ===== DURATION CHART (UNCHANGED) ===== */
      new Chart(durationChart, {
        plugins: [whiteBackgroundPlugin],
        type: "bar",
        data: {
          labels: report.tests.map(t => t.name),
          datasets: [{
            label: "Duration (ms)",
            data: report.tests.map(t => t.duration),
            backgroundColor: "#2196F3"
          }]
        }
      });

      /* ===== FAILED LOGS (FULL DETAILS PRESERVED) ===== */
      const list = document.getElementById("test-list");

      report.tests.filter(t => t.status === "failed").forEach(test => {
        const div = document.createElement("div");
        div.className = "test-card failed";

        div.innerHTML = `
      <h3>${test.name}</h3>
      <p><strong>Suite:</strong> ${test.suiteName}</p>
      <p class="error">Failure Reason:<br>${test.errorMessage || "N/A"}</p>
      ${test.errorTrace ? `<div class="trace">${test.errorTrace}</div>` : ""}
      <p><strong>Retries:</strong> ${test.retries}</p>
      <p><strong>Duration:</strong> ${test.duration} ms</p>

      <h4>Screenshot</h4>
      ${test.attachments.length
            ? test.attachments.map(a =>
              `<img class="screenshot" src="../${a.source}">`
            ).join("")
            : "<p>No screenshot available.</p>"
          }
    `;

        list.appendChild(div);
      });
    });
  </script>

</body>

</html>