<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Allure Suite Report</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      font-size: 32px;
    }

    h2 {
      margin-top: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th,
    td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
      vertical-align: top;
    }

    .passed {
      background: #c8f7c5;
    }

    .failed {
      background: #f7c5c5;
    }

    .skipped {
      background: #dddddd;
    }

    .test-card {
      border: 1px solid #aaa;
      padding: 15px;
      margin: 15px 0;
      border-radius: 6px;
    }

    img.screenshot {
      width: 90%;
      max-width: 900px;
      height: auto;
      margin-top: 12px;
      border: 1px solid #666;
      display: block;
    }

    .error {
      color: #b00020;
      font-weight: bold;
      white-space: pre-wrap;
    }

    .trace {
      font-size: 12px;
      background: #f5f5f5;
      padding: 10px;
      border-left: 4px solid #f44336;
      white-space: pre-wrap;
      margin-top: 8px;
    }

    .page {
      page-break-before: always;
    }

    .page:first-of-type {
      page-break-before: avoid;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    window.REPORT_DATA = {"stats":{"total":14,"passed":"14 (100.00%)","failed":"0 (0.00%)","broken":"0 (0.00%)","skipped":"0 (0.00%)","retries":"2 (14.29%)"},"tests":[{"name":"logs in successfully with valid credentials","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"c27d9be6cd6097c7","start":1769611631304,"stop":1769611685609,"duration":54305,"retries":1,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"logs in successfully with valid credentials and upload inspiration file","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"6cae112328037e0f","start":1769611685738,"stop":1769611724316,"duration":38578,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Searches for the Uploaded theme and share it with a vendor","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"6fe19ecf7218d136","start":1769611724586,"stop":1769611776255,"duration":51669,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Verify that shared Inspiration is visible and submit design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"c7fb23b46e2f876e","start":1769611776514,"stop":1769611842459,"duration":65945,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Cluster Reworks the  submitted design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"43fed38c19e611e","start":1769611842935,"stop":1769611889517,"duration":46582,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Vendor makes changes to rework design after cluster rework","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"9f564a72a350fa81","start":1769611889785,"stop":1769611974131,"duration":84346,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Cluster approval for submitted design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"1b85599616bb5834","start":1769611974688,"stop":1769612019229,"duration":44541,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Rework after cluster approval","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"bbd24b192cfc1a21","start":1769612020169,"stop":1769612052719,"duration":32550,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Parks","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"7a055b54380021a3","start":1769612130947,"stop":1769612188318,"duration":57371,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Unparks the design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"aad937b4da2dffcc","start":1769612189562,"stop":1769612218067,"duration":28505,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Parks again","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"1094587a9b18aa2a","start":1769612218662,"stop":1769612261488,"duration":42826,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Rework the parked design","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"c6ee473508ee4afa","start":1769612263804,"stop":1769612302611,"duration":38807,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Vendor makes changes to rework design after buyer rework","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"4e3c859544ed6a10","start":1769612302902,"stop":1769612380479,"duration":77577,"retries":1,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]},{"name":"Buyer Approval after vendor rework","status":"passed","suiteName":"Impetus Platform — Login Page Tests","uid":"8a3bbcf28977c8cf","start":1769612380671,"stop":1769612448635,"duration":67964,"retries":0,"flaky":false,"errorMessage":"","errorTrace":"","attachments":[]}]};
  </script>
</head>

<body>

  <h1>Allure Execution PDF</h1>

  <!-- ================= PAGE 1 ================= -->
  <div class="page">
    <h2>Summary</h2>
    <table>
      <tr>
        <th>Total</th>
        <th>Passed</th>
        <th>Failed</th>
        <th>Skipped</th>

      </tr>
      <tr>
        <td id="total"></td>
        <td id="passed" class="passed"></td>
        <td id="failed" class="failed"></td>
        <td id="skipped" class="skipped"></td>

      </tr>
    </table>
    <h2>Test List</h2>
    <table id="tests-table">
      <thead>
        <tr>
          <th>Test Name</th>
          <th>Status</th>
          <th>Duration (ms)</th>

        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- ================= PAGE 2 ================= -->
  <div class="page">
    <h2>Status Distribution</h2>
    <canvas id="pieChart" width="600" height="600"></canvas>
  </div>

  <!-- ================= PAGE 3 ================= -->
  <div class="page">
    <h2>Duration per Test</h2>
    <canvas id="durationChart" height="300"></canvas>
  </div>

  <!-- ================= PAGE 4+ ================= -->
  <div class="page" id="failed-logs-page">
  <h2>Failed Logs</h2>
  <div id="test-list"></div>
</div>

  <script>
    /* ===== WHITE BACKGROUND FIX ===== */
    const whiteBackgroundPlugin = {
      id: 'whiteBackground',
      beforeDraw(chart) {
        const ctx = chart.ctx;
        ctx.save();
        ctx.globalCompositeOperation = 'destination-over';
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, chart.width, chart.height);
        ctx.restore();
      }
    };

    /* ===== LABELS INSIDE PIE ===== */
    const pieLabelPlugin = {
      id: 'pieLabelPlugin',
      afterDraw(chart) {
        const ctx = chart.ctx;
        const dataset = chart.data.datasets[0];
        const meta = chart.getDatasetMeta(0);

        ctx.save();
        ctx.font = "bold 16px Arial";
        ctx.fillStyle = "#ffffff";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        meta.data.forEach((arc, index) => {
          const value = dataset.data[index];
          if (!value) return;
          const pos = arc.tooltipPosition();
          ctx.fillText(`${chart.data.labels[index]}: ${value}`, pos.x, pos.y);
        });

        ctx.restore();
      }
    };

    document.addEventListener("DOMContentLoaded", () => {
      const report = window.REPORT_DATA;

      total.innerText = report.stats.total;
      passed.innerText = report.stats.passed;
      failed.innerText = report.stats.failed;
      skipped.innerText = report.stats.skipped;


      /* ===== POPULATE TESTS TABLE ===== */
      const testsTbody = document.querySelector("#tests-table tbody");

      report.tests.forEach(test => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
    <td>${test.name}</td>
    <td class="${test.status}">${test.status}</td>
    <td>${test.duration}</td>
    
  `;
        testsTbody.appendChild(tr);
      });


      /* ===== PIE CHART ===== */
      new Chart(pieChart, {
        type: "pie",
        plugins: [whiteBackgroundPlugin, pieLabelPlugin],
        data: {
          labels: ["Passed", "Failed", "Skipped"],
          datasets: [{
            data: [
              parseInt(report.stats.passed),
              parseInt(report.stats.failed),
              parseInt(report.stats.skipped)
            ],
            backgroundColor: ["#4CAF50", "#F44336", "#9E9E9E"],
            borderWidth: 0,
            radius: "92%"
          }]
        },
        options: {
          responsive: false,
          animation: false,
          plugins: {
            legend: {
              position: "right",
              labels: {
                font: { size: 14 }
              }
            }
          }
        }
      });

      /* ===== DURATION CHART (UNCHANGED) ===== */
      new Chart(durationChart, {
        plugins: [whiteBackgroundPlugin],
        type: "bar",
        data: {
          labels: report.tests.map(t => t.name),
          datasets: [{
            label: "Duration (ms)",
            data: report.tests.map(t => t.duration),
            backgroundColor: "#2196F3"
          }]
        }
      });

      const failedLogsPage = document.getElementById("failed-logs-page");
const list = document.getElementById("test-list");

const failedTests = report.tests.filter(t => t.status === "failed");

if (failedTests.length === 0) {
  // ✅ Completely remove the page (PDF-safe)
  failedLogsPage.remove();
} else {
  failedTests.forEach(test => {
    const div = document.createElement("div");
    div.className = "test-card failed";

    div.innerHTML = `
      <h3>${test.name}</h3>
      <p><strong>Suite:</strong> ${test.suiteName || "N/A"}</p>
      <p class="error">Failure Reason:<br>${test.errorMessage || "N/A"}</p>
      ${test.errorTrace ? `<div class="trace">${test.errorTrace}</div>` : ""}
      <p><strong>Duration:</strong> ${test.duration} ms</p>
    `;

    list.appendChild(div);
  });
}




    });
  </script>

</body>

</html>